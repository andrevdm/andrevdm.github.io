<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Andre's Blog</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../contact.html">Contact</a>
                <!-- <a href="/about.html">About</a> -->
            </div>
        </div>

        <div id="content">
            <h1><a href="#top">Unit testing embedded C projects with seatest</a></h1>

            <div class="info">
    Posted on July 25, 2014
    
</div>

<p>I recently wrote my first embedded C project and was surprised to find that unit tests were not as widely used as I would have expected. There seems to be a general opinion that unit tests are less useful for embedded development that for application development. I find this strange because debugging embedded systems is hard compared to application development.</p>
<p>Fortunately not everyone agrees with this sentiment and in the end it was pretty easy to get unit tests working thanks to <a href="https://code.google.com/p/seatest/">SeaTest</a> (https://code.google.com/p/seatest/). SeaTest is simple and specifically designed for embedded-c projects.</p>
<p>To get it working for a Microchip MPLabX project I did this</p>
<ol type="1">
<li>Created a _test directory in my main projects directory</li>
<li>Created my unit tests in this directory in test.c</li>
<li>In this directory created a bash script named “test”</li>
<li>Copied seatest.c and seatest.h into the directory</li>
<li>Created dummy PIC include files in this directory
<ol type="1">
<li>xc.h</li>
<li>xc.c</li>
<li>pic18f4550.h</li>
</ol></li>
<li>Created a plib directory under _test containing
<ol type="1">
<li>timers.h The idea being that the my test directory (_test) contained files for mocking the Microchip libraries to make testing possible. This turned out to be much simpler than I had feared.</li>
</ol></li>
</ol>
<p><strong>Test runner bash script</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">    <span class="co">#/bin/sh</span></a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="fu">gcc</span> -std=c99 -o test.o -D TESTING -I . -I .. xc.c test.c ../buttons.c ../lcd.c ../dateTime.c ../timerUi.c ../timer.c seatest.c <span class="kw">&amp;&amp;</span> <span class="ex">./test.o</span></a></code></pre></div>
<p>Nothing fancy… It does this</p>
<ul>
<li>Defines a TESTING constant</li>
<li>Includes the local directory for the “mock” libraries</li>
<li>Includes the parent directory for my actual code</li>
<li>Runs ./test.o if the compile succeeds</li>
</ul>
<p><strong>Mock/Stub files</strong></p>
<p>Most of the stub files (timers.h etc) are empty files just to keep the compiler happy. I then just copied whatever definitions I needed from MPLabX’s libraries to get the rest working.</p>
<p><strong>Tests</strong></p>
<p>Tests are then simply a matter of calling a function and using the seatest assert functions.</p>
<p>There definitely are things that are hard to test e.g. interrupt routines but as long as your code is modular you should usually be able to test the methods that e.g. the interrupt routine calls.</p>
<p>Overall I found this to be a very simple approach and it certainly helped me get my project up and running a lot faster with a lot more confidence</p>


        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          
          ga('create', 'UA-78428674-1', 'auto');
          ga('send', 'pageview');
        </script>
    </body>
</html>
