<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Andre's Blog</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../contact.html">Contact</a>
                <!-- <a href="/about.html">About</a> -->
            </div>
        </div>

        <div id="content">
            <h1><a href="#top">Accurate clock with any frequency oscillator</a></h1>

            <div class="info">
    Posted on January  3, 2015
    
</div>

<p>When I created an electric timer using a PIC one of the things I needed was an accurate clock. The PIC I was using did not have a built in real-time clock (RTC) and I did not want to use an external one. After some searching I found two popular suggestions to create an accurate clock</p>
<ol type="1">
<li>Use a 32.768kHz crystal which divides down perfectly to give you seconds etc</li>
<li>Use any frequency oscillator and manually set the value of the timer register on each interrupt. I.e. to skip some number of cycles I did not like either of these solutions</li>
<li>32.768kHz is ridiculously slow compared to the 20-40MHz the PICs can run at</li>
<li>Manually setting the timer register takes some number of clock cycles and this will affect the timing. Working out how many clock cycles exactly sounds like an error prone and rather boring task Fortunately I found this article <a href="http://www.romanblack.com/one_sec.htm">“A very versatile Zero Cumulative Error timing system with PIC source code”</a>. It shows a really simple way to get an accurate clock, i.e. no accumulating error,using any oscillator frequency. Take a look at the article. It has PIC source code and a nice explanation.<br />
Its a brilliantly simple solution. Here is my attempt to explain it. Perhaps having two different explanations helps.<br />
Imagine you have an oscillator that ticks every 3 units but a clock event that needs to happen every 5 units of time. The key to understanding this is that even though 3 does not go into 5 you can get close without accumulating error.<br />
Consider the first 5 oscillator ticks</li>
</ol>
<ul>
<li>3 - less that first time period (5), do nothing</li>
<li>6 - greater that first time period (5), do clock</li>
<li>9 - less that second time period (10), do nothing</li>
<li>12 - greater that second time period (10), do clock</li>
<li>15 - equal to third time period (15), do clock</li>
</ul>
<p>So at each oscillator tick there is some discrepancy but it does not accumulate. In the example above the clock is 100% accurate every fifteenth oscillation.<br />
With a micro running at many megahertz you can adjust the timer prescale to make this periodic discrepancy as small or large as you like.<br />
In my timer I was happy to be out by a few seconds at any time. Of course you could of course use a smaller prescale value and keep it down to milliseconds if you really need to</p>


        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          
          ga('create', 'UA-78428674-1', 'auto');
          ga('send', 'pageview');
        </script>
    </body>
</html>
